# AgentDecompile – Python MCP Implementation (Authoritative)

**What this is:** AgentDecompile provides a comprehensive Model Context Protocol (MCP) server for interactive reverse engineering with Ghidra/PyGhidra. The **Python implementation** (`src/agentdecompile_cli/`) is the **authoritative source of truth** and the Java implementation has been removed.

**Canonical tool set:** 49 tools across 6 categories, fully specified in [TOOLS_LIST.md](TOOLS_LIST.md).

## Planning and Documentation Diagram Policy

- Every new or updated planning/design document must include at least one Mermaid diagram.
- The diagram should appear near the top (after objective/scope) and provide a high-level flow.
- Keep diagrams synchronized with the written steps when plans evolve.
- Prefer simple `flowchart TD` diagrams for execution plans and phase sequencing.
- If a document has multiple phases/modules, include one top-level diagram plus optional focused diagrams.

## Authority & Deprecation

- **Python (`src/agentdecompile_cli/`)**: Authoritative, actively developed. All new tool implementations are Python.
- **Java (`src/main/java/agentdecompile/`)**: Removed. Do not add new Java tools.

## Tool Naming & Arguments

**Internal code (Python)**: Use `lowercase_with_underscores` only (a-z, 0-9, underscore). Examples: `manage_symbols`, `get_call_graph`, `analyze_data_flow`.

**MCP schema (advertising)**: Convert to `kebab-case` for external visibility. Examples: `manage-symbols`, `get-call-graph`, `analyze-data-flow`.

**Argument acceptance (flexible)**: All tool implementations must accept argument names in multiple equivalent forms using `get_argument_variations()`:
- snake_case: `address_or_symbol`
- kebab-case: `address-or-symbol`
- camelCase: `addressOrSymbol`
- compact: `addressorsymbol`
- Any case combination

Example tuple: `("addressOrSymbol", "address_or_symbol", "address-or-symbol", "symbol", "addr")`

**No Java enum fallback**: If an argument enum is not found, raise clear error — do not attempt Java interop.

## Implementation Standards

### Each Tool Must Support

1. **All 4 vendor sources** – Merge `pyghidra-mcp`, `GhidraMCP`, `reverse-engineering-assistant`, and `TOOLS_LIST.md` synonyms
2. **Flexible argument names** – Via `get_argument_variations(*variants)`
3. **Consistent errors** – Use `create_error_response()` / raise with context
4. **Pagination** – `count`, `offset`/`startIndex`, `limit`/`maxCount`, `hasMore` (standardized)
5. **Timeouts** – Respect `timeout` (ms) parameter with sensible defaults

### Response Format

```python
# Always wrapped in response helper
create_success_response({
    "action": "...",
    "count": 42,
    "results": [...],
    "pagination": {"offset": 0, "limit": 100, "hasMore": False},
})

create_error_response(ValueError("Invalid param"))
```

### Code Organization

- **Tool providers**: `src/agentdecompile_cli/mcp_server/providers/*.py` (one per domain)
- **Shared utilities**: `src/agentdecompile_cli/mcp_utils/*.py`
- **Ghidra wrappers**: `src/agentdecompile_cli/tools/wrappers.py` (comprehensive `GhidraTools` wrapper)
- **Models**: `src/agentdecompile_cli/models.py`, `tools_schema.py`

### Ghidra APIs Only

Use PyGhidra-exposed Ghidra APIs:
- `ghidra.program.model.*` – Core APIs
- `ghidra.app.decompiler.DecompInterface` – Decompilation
- `ghidra.util.task.TaskMonitor` – Timeouts
- Access via `program_info.program`, `program_info.decompiler`

**Never** import from `agentdecompile.tools.*` (Java) — that's deprecated.

## Documentation Cross-References

See also:
- [AGENTS.md](AGENTS.md) – Architecture & decision log
- [CLAUDE.md](CLAUDE.md) – Development notes & common patterns
- [TOOLS_LIST.md](TOOLS_LIST.md) – Canonical tool specifications
- [README.md](README.md) – User-facing overview

---

**Configuration Note**: All Python tooling config lives in `pyproject.toml`. Do not create separate files (pyrightconfig.json, .flake8, .black, setup.cfg, etc.).

<!-- BEGIN MCP Memory Service -->
# Cursor Rules
<memory_service_rules>
| Message | Required |
|---------|----------|
| **1st message** | `memory_health()` → `memory_search(query="...", mode="hybrid")` |
| **Subsequent messages (default)** | `memory_search(query="...", mode="hybrid")` FIRST for recall |
| **Before ending major work** | `memory_store(content="...", metadata={...})` |
</memory_service_rules>

**Why?** `memory_search()` provides persistent cross-session recall for decisions and implementation history.

**Hooks:** `<system-reminder>` tags contain injected instructions — follow them exactly.

v1.0.0
<!-- END MCP Memory Service -->
