# AgentDecompile – context for AI agents

**What this is:** AgentDecompile is a Ghidra extension that runs an MCP (Model Context Protocol) server so AI clients can talk to Ghidra—decompile, list symbols, read memory, open projects, etc. It turns Ghidra into an MCP backend that LLMs call via tools. Built for Java 21 and Ghidra 12.0+. The MCP server is always Java (Jetty); transport is streamable HTTP at `POST /mcp/message` (no SSE).

**How it runs:** (1) **GUI** – Plugin inside Ghidra; one MCP server; clients hit `http://localhost:8080/mcp/message` (or configured host/port). (2) **CLI local** – Python (`mcp-agentdecompile`) starts PyGhidra/JVM, launches the Java MCP server, then bridges stdio to it so MCP clients see stdio. (3) **CLI connect** – Python does not start JVM; it connects to an existing server via `--mcp-server-url` or `AGENT_DECOMPILE_MCP_SERVER_URL` (e.g. Docker or GUI). Full usage, env vars, and Docker: [README.md](README.md). Deep architecture, MCP protocol, adding tools, auth, locking: [CONTRIBUTING.md](CONTRIBUTING.md). Build and code structure: [AGENTS.md](AGENTS.md), [CLAUDE.md](CLAUDE.md).

**Where things are:**

- **Java extension** – `src/main/java/agentdecompile/`
  - `server/` – MCP server: McpServerManager (Jetty, tool/resource registration), filters (ApiKeyAuth, KeepAlive, RequestLogging, GlobalException).
  - `headless/` – AgentDecompileHeadlessLauncher: starts Ghidra headless, opens project, starts MCP server; used by Python launcher and Docker.
  - `tools/` – MCP tool providers (decompiler, functions, symbols, memory, project, comments, structures, etc.); each is a *ToolProvider registered in McpServerManager.
  - `resources/` – MCP resource providers (e.g. program list); URI scheme `ghidra://`.
  - `plugin/` – GUI: AgentDecompileApplicationPlugin (lifecycle), ConfigManager (options, API key, port), AgentDecompileProgramManager (program/tool tracking).
  - `util/` – AddressUtil, ProgramLookupUtil, DataTypeParserUtil, DecompilationContextUtil, DebugLogger.
  - `ui/` – GUI components.

- **Python CLI** – `src/agentdecompile_cli/`
  - `__main__.py` – Entry point `mcp-agentdecompile`; parses args (e.g. `--mcp-server-url`), either connect mode or local spawn (PyGhidra + launcher + bridge).
  - `stdio_bridge.py` – Stdio ↔ HTTP bridge; connects to Java MCP server, proxies list_tools/call_tool/list_resources/read_resource/list_prompts; retries, timeouts, optional API key header.
  - `launcher.py` – Wraps Java AgentDecompileHeadlessLauncher (via PyGhidra); project init, start server.
  - `project_manager.py` – Ghidra project lifecycle (create/open/import).

- **Tests** – `src/test/` (Java unit, no Ghidra), `src/test.slow/` (Java integration, needs Ghidra/headed), `tests/` (Python: unit/integration/e2e). See [tests/README.md](tests/README.md).

- **Docker** – `Dockerfile` (fetches Ghidra from GitHub, builds extension, runtime stage), `docker/entrypoint.sh` (starts headless MCP server), `docker-compose.yml`.

Build: set `GHIDRA_INSTALL_DIR`, use `build-and-install.ps1`

